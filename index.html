<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: space-between;
            padding: 20px;
        }
        #scanner-container {
            width: 50%;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #scanner-container video {
            width: 100%;
            height: auto;
        }
        #attendance-list {
            width: 40%;
            border: 1px solid #ccc;
            padding: 10px;
        }
        #attendance-list h2 {
            margin-top: 0;
        }
        .attendance-item {
            margin-bottom: 10px;
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        .attendance-item strong {
            display: block;
        }
        .attendance-item small {
            color: #666;
        }
    </style>
</head>
<body>
    <div id="scanner-container">
        <h2>Scanner</h2>
        <video id="video" autoplay></video>
        <canvas id="canvas" style="display: none;"></canvas>
    </div>
    <div id="attendance-list">
        <h2>Attendance List</h2>
        <div id="list"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <script>
        // Predefined student data (student number to name mapping)
        const students = {
            "25-0350": "Christopher I. Madamba",
            "67890": "Jane Smith",
            "11111": "Alice Johnson",
            "22222": "Bob Brown"
        };

        // Array to hold attendance records
        let attendance = [];

        // Function to update the attendance list display
        function updateAttendanceList() {
            const listElement = document.getElementById('list');
            listElement.innerHTML = '';
            attendance.forEach(record => {
                const item = document.createElement('div');
                item.className = 'attendance-item';
                item.innerHTML = `
                    <strong>${record.name} (ID: ${record.studentNumber})</strong>
                    <small>Scanned at: ${record.timestamp}</small>
                `;
                listElement.appendChild(item);
            });
        }

        // Initialize camera and QuaggaJS
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(stream => {
                const video = document.getElementById('video');
                video.srcObject = stream;
                video.play();

                // Initialize QuaggaJS
                Quagga.init({
                    inputStream: {
                        name: "Live",
                        type: "LiveStream",
                        target: video,
                        constraints: {
                            width: 640,
                            height: 480,
                            facingMode: "environment"
                        }
                    },
                    locator: {
                        patchSize: "medium",
                        halfSample: true
                    },
                    numOfWorkers: 2,
                    decoder: {
                        readers: ["code_128_reader", "ean_reader", "upc_reader"] // Common barcode types
                    },
                    locate: true
                }, function(err) {
                    if (err) {
                        console.error(err);
                        return;
                    }
                    Quagga.start();
                });

                // On barcode detection
                Quagga.onDetected(function(result) {
                    const code = result.codeResult.code;
                    if (students[code]) {
                        const now = new Date();
                        const timestamp = now.toLocaleString();
                        attendance.push({
                            studentNumber: code,
                            name: students[code],
                            timestamp: timestamp
                        });
                        updateAttendanceList();
                        // Optional: Provide feedback (e.g., beep or alert)
                        console.log(`Scanned: ${students[code]} (${code}) at ${timestamp}`);
                    } else {
                        console.log(`Unknown student number: ${code}`);
                    }
                });
            })
            .catch(err => {
                console.error('Error accessing camera:', err);
                alert('Camera access denied or not available.');
            });
    </script>
</body>

</html>
